<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PTFD Apparatus Inventory</title>
    <link rel="icon" type="image/x-icon" href="./images/favicon.ico">
    
    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EMS Inv">
    
    <!-- App Icon (Embedded Red Cross for Home Screen) -->
    <link rel="apple-touch-icon" href="./assets/apple-touch-icon4.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Import Map for Modules -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js",
            "lucide-react": "https://esm.sh/lucide-react@0.344.0"
        }
    }
    </script>
    <style>
        /* Remove tap highlight on mobile to use our own styles */
        * {
            -webkit-tap-highlight-color: transparent;
        }
        /* Handle Safe Areas for iPhone X/New iPads */
        .safe-top {
            padding-top: env(safe-area-inset-top);
        }
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        /* Hide scrollbar for cleaner UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Custom styles for date and time inputs to ensure proper sizing */
        input[type="date"], input[type="datetime-local"] {
            width: 90%; /* Reverts to the browser's default sizing */
            max-width: 100%; /* Ensures it doesn't exceed its container */
            box-sizing: border-box;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 select-none">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged, 
            signOut 
        } from 'firebase/auth';
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            updateDoc, 
            deleteDoc, 
            doc, 
            onSnapshot,
            writeBatch
        } from 'firebase/firestore';
        import { 
            AlertTriangle, 
            Search, 
            Plus, 
            Trash2, 
            Edit, 
            FileUp, 
            X, 
            Truck, 
            MapPin, 
            Calendar,
            Package,
            Filter,
            ChevronRight
        } from 'lucide-react';

        // --- Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyBTjbo2ndQYowrvmcDxeXfvNb_E3nSijH8",
            authDomain: "ems-inventory.firebaseapp.com",
            projectId: "ems-inventory",
            storageBucket: "ems-inventory.firebasestorage.app",
            messagingSenderId: "1076236960850",
            appId: "1:1076236960850:web:07cc24cd638ef4a8298b8b",
            measurementId: "G-BFFXWP4G42"
        };

        // --- Initialization ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Use global app ID if available, otherwise default
        const appId = typeof window.__app_id !== 'undefined' ? window.__app_id : 'ems-inventory-default';
        const COLLECTION_NAME = 'ems_supplies';

        // --- Helper Functions ---
        
        // Helper to parse YYYY-MM-DD as local date components to avoid UTC timezone shifts
        const parseLocalDate = (dateString) => {
            if (!dateString) return null;
            // Handle YYYY-MM-DD format manually
            if (dateString.includes('-')) {
                const parts = dateString.split('-');
                if (parts.length === 3) {
                    // Create date as Local Time (using year, monthIndex, day constructor)
                    // Note: Month is 0-indexed in JS Date constructor
                    return new Date(parts[0], parts[1] - 1, parts[2]);
                }
            }
            // Fallback for standard date parsing
            return new Date(dateString);
        };

        const formatDateForInput = (dateString) => {
            if (!dateString) return '';
            const date = parseLocalDate(dateString);
            if (!date || isNaN(date.getTime())) return '';
            
            // Use local components to reconstruct YYYY-MM-DD, preventing UTC shift
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        };

        const formatDateDisplay = (dateString) => {
            if (!dateString) return 'N/A';
            const date = parseLocalDate(dateString);
            if (!date || isNaN(date.getTime())) return dateString;
            return date.toLocaleDateString();
        };

        const isExpired = (dateString) => {
            if (!dateString) return false;
            const date = parseLocalDate(dateString);
            const now = new Date();
            now.setHours(0,0,0,0); // Compare against start of today
            return date < now;
        };

        const isExpiringSoon = (dateString, days = 30) => {
            if (!dateString) return false;
            const date = parseLocalDate(dateString);
            const now = new Date();
            now.setHours(0,0,0,0);
            const future = new Date(now);
            future.setDate(future.getDate() + days);
            return date >= now && date <= future;
        };

        // --- Components ---

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4 backdrop-blur-sm safe-bottom safe-top">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-md max-h-full overflow-y-auto flex flex-col">
                        <div className="flex justify-between items-center p-4 border-b sticky top-0 bg-white z-10">
                            <h2 className="text-xl font-bold text-gray-800">{title}</h2>
                            <button onClick={onClose} className="p-2 -mr-2 text-gray-500 hover:text-gray-700 active:bg-gray-100 rounded-full">
                                <X size={24} />
                            </button>
                        </div>
                        <div className="p-4 flex-1">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        const StatusBadge = ({ expires }) => {
            if (isExpired(expires)) {
                return (
                    <span className="inline-flex items-center px-2 py-1 rounded-md text-xs font-bold bg-red-100 text-red-800 border border-red-200">
                        <AlertTriangle size={12} className="mr-1" /> Expired
                    </span>
                );
            }
            if (isExpiringSoon(expires)) {
                return (
                    <span className="inline-flex items-center px-2 py-1 rounded-md text-xs font-bold bg-yellow-100 text-yellow-800 border border-yellow-200">
                        <AlertTriangle size={12} className="mr-1" /> Soon
                    </span>
                );
            }
            return (
                <span className="inline-flex items-center px-2 py-1 rounded-md text-xs font-bold bg-green-100 text-green-800 border border-green-200">
                    OK
                </span>
            );
        };

        const CSVImporter = ({ onImport, onClose }) => {
            const [csvText, setCsvText] = useState('');
            const [status, setStatus] = useState('idle');

            const exampleData = `Apparatus,Location,SubLocation,Equipment,Expires,Notes
Medic 75,Drug Cabinet,,1000ml Saline Bag,2/28/2026,
Medic 75,IV Drawers,,1000ml Saline Bag,2/28/2026,
Medic 75,Code Bag,Main Comp - Blue IV Kit,1000ml Saline Bag,1/31/2027,
Engine 1-75,First-In Bag,Main Compartment,1000ml Saline Bottle,10/31/2027,
Medic 75,Compartment 3,,Soft Suction 12fr,9/30/2018,EXPIRED EXAMPLE`;

            const handleParse = async () => {
                setStatus('parsing');
                try {
                    const lines = csvText.trim().split('\n');
                    if (lines.length < 2) throw new Error("CSV appears empty or invalid");

                    const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
                    const records = [];

                    for (let i = 1; i < lines.length; i++) {
                        const row = lines[i].split(',');
                        if (row.length < 2) continue;

                        const record = {
                            apparatus: row[0]?.trim() || 'Unknown',
                            location: row[1]?.trim() || '',
                            subLocation: row[2]?.trim() || '',
                            equipment: row[3]?.trim() || 'Unknown Item',
                            // Ensure date is formatted for YYYY-MM-DD input
                            expires: formatDateForInput(row[4]?.trim()), 
                            notes: row.slice(5).join(',').trim()
                        };
                        records.push(record);
                    }
                    
                    await onImport(records);
                    setStatus('success');
                    setTimeout(onClose, 1500);
                } catch (e) {
                    console.error(e);
                    setStatus('error');
                }
            };

            return (
                <div className="space-y-4">
                    <p className="text-sm text-gray-600">
                        Headers required: Apparatus, Location, SubLocation, Equipment, Expires, Notes.
                    </p>
                    <button 
                        onClick={() => setCsvText(exampleData)}
                        className="text-xs text-blue-600 font-semibold p-1 -ml-1"
                    >
                        Load Example Data
                    </button>
                    <textarea
                        className="w-full h-48 p-3 border rounded-lg font-mono text-base bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none"
                        value={csvText}
                        onChange={(e) => setCsvText(e.target.value)}
                        placeholder="Paste CSV content here..."
                    />
                    
                    <button 
                        onClick={handleParse}
                        disabled={status === 'parsing' || !csvText}
                        className="w-full bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center font-bold shadow-sm active:transform active:scale-95 transition-all"
                    >
                        {status === 'parsing' ? 'Importing...' : 'Import Data'}
                        {status === 'success' && <span className="ml-2">✓ Done</span>}
                    </button>
                    {status === 'error' && (
                        <p className="text-red-600 text-sm text-center">Error parsing CSV. Check format.</p>
                    )}
                </div>
            );
        };

        const ItemForm = ({ initialData, onSubmit, onCancel, onDelete }) => {
            const [formData, setFormData] = useState({
                apparatus: 'Medic 75',
                location: '',
                subLocation: '',
                equipment: '',
                expires: '',
                notes: ''
            });

            useEffect(() => {
                if (initialData) {
                    // initialData.expires is usually YYYY-MM-DD from Firestore
                    setFormData(initialData);
                }
            }, [initialData]);

            const handleChange = (e) => {
                setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                onSubmit(formData);
            };

            return (
                <form onSubmit={handleSubmit} className="flex flex-col h-full space-y-5">
                    <div className="space-y-4 flex-1">
                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-1">Apparatus</label>
                            <select 
                                name="apparatus" 
                                value={formData.apparatus} 
                                onChange={handleChange}
                                className="block w-full rounded-lg border-gray-300 bg-gray-50 p-3 focus:ring-2 focus:ring-blue-500 outline-none border text-base"
                            >
                                <option value="Medic 75">Medic 75</option>
                                <option value="Engine 1-75">Engine 1-75</option>
                                <option value="Stock Room">Stock Room</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-1">Equipment Name</label>
                            <input 
                                type="text" 
                                name="equipment" 
                                value={formData.equipment} 
                                onChange={handleChange}
                                required
                                className="block w-full rounded-lg border-gray-300 bg-gray-50 p-3 focus:ring-2 focus:ring-blue-500 outline-none border text-base"
                            />
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">Location</label>
                                <input 
                                    type="text" 
                                    name="location" 
                                    value={formData.location} 
                                    onChange={handleChange}
                                    className="block w-full rounded-lg border-gray-300 bg-gray-50 p-3 focus:ring-2 focus:ring-blue-500 outline-none border text-base"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">Sub-Location</label>
                                <input 
                                    type="text" 
                                    name="subLocation" 
                                    value={formData.subLocation} 
                                    onChange={handleChange}
                                    className="block w-full rounded-lg border-gray-300 bg-gray-50 p-3 focus:ring-2 focus:ring-blue-500 outline-none border text-base"
                                />
                            </div>
                        </div>

                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-1">Expiration Date</label>
                            <input 
                                type="date" 
                                name="expires" 
                                value={formData.expires} 
                                onChange={handleChange}
                                required
                                className="block w-full rounded-lg border-gray-300 bg-gray-50 p-3 focus:ring-2 focus:ring-blue-500 outline-none border text-base"
                            />
                        </div>

                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-1">Notes</label>
                            <textarea 
                                name="notes" 
                                value={formData.notes} 
                                onChange={handleChange}
                                className="block w-full rounded-lg border-gray-300 bg-gray-50 p-3 focus:ring-2 focus:ring-blue-500 outline-none border text-base"
                                rows={2}
                            />
                        </div>
                    </div>

                    <div className="pt-4 border-t space-y-3">
                        <div className="flex gap-3">
                            <button 
                                type="button" 
                                onClick={onCancel}
                                className="flex-1 px-4 py-3 border border-gray-300 rounded-lg text-sm font-semibold text-gray-700 hover:bg-gray-50 active:bg-gray-100 transition-colors"
                            >
                                Cancel
                            </button>
                            <button 
                                type="submit" 
                                className="flex-1 px-4 py-3 border border-transparent rounded-lg shadow-sm text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 active:bg-blue-800 transition-colors"
                            >
                                Save Item
                            </button>
                        </div>

                        {initialData && onDelete && (
                            <button 
                                type="button" 
                                onClick={onDelete}
                                className="w-full px-4 py-3 border border-red-200 rounded-lg text-sm font-bold text-red-600 bg-red-50 hover:bg-red-100 active:bg-red-200 transition-colors flex items-center justify-center"
                            >
                                <Trash2 size={18} className="mr-2" />
                                Delete Item
                            </button>
                        )}
                    </div>
                </form>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [inventory, setInventory] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            
            // UI State
            const [searchTerm, setSearchTerm] = useState('');
            const [filterApparatus, setFilterApparatus] = useState('All');
            const [isFormOpen, setIsFormOpen] = useState(false);
            const [isImportOpen, setIsImportOpen] = useState(false);
            const [editingItem, setEditingItem] = useState(null);

            // --- Auth & Data Fetching ---
            useEffect(() => {
                const initAuth = async () => {
                    try {
                        if (typeof window.__initial_auth_token !== 'undefined' && window.__initial_auth_token) {
                            try {
                                await signInWithCustomToken(auth, window.__initial_auth_token);
                            } catch (tokenError) {
                                console.warn("Custom token failed, falling back to anonymous auth:", tokenError);
                                await signInAnonymously(auth);
                            }
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (err) {
                        console.error("Auth error", err);
                        setError("Authentication failed. Check config.");
                    }
                };
                initAuth();

                return onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                });
            }, []);

            useEffect(() => {
                if (!user) return;

                const q = collection(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME);

                const unsubscribe = onSnapshot(q, 
                    (snapshot) => {
                        const items = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        items.sort((a, b) => {
                            if (!a.expires) return 1;
                            if (!b.expires) return -1;
                            return new Date(a.expires) - new Date(b.expires);
                        });
                        setInventory(items);
                        setLoading(false);
                    },
                    (err) => {
                        console.error("Firestore error", err);
                        setError("Could not load inventory data.");
                        setLoading(false);
                    }
                );

                return () => unsubscribe();
            }, [user]);

            // --- Actions ---
            const handleAddItem = async (data) => {
                if (!user) return;
                try {
                    const colRef = collection(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME);
                    await addDoc(colRef, {
                        ...data,
                        updatedBy: user.uid,
                        updatedAt: new Date().toISOString()
                    });
                    setIsFormOpen(false);
                } catch (err) {
                    console.error(err);
                    alert("Failed to add item");
                }
            };

            const handleUpdateItem = async (data) => {
                if (!user || !editingItem) return;
                try {
                    const docRef = doc(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME, editingItem.id);
                    await updateDoc(docRef, {
                        ...data,
                        updatedBy: user.uid,
                        updatedAt: new Date().toISOString()
                    });
                    setIsFormOpen(false);
                    setEditingItem(null);
                } catch (err) {
                    console.error(err);
                    alert("Failed to update item");
                }
            };

            const handleDeleteItem = async (id) => {
                if (!user) return;
                if (!window.confirm("Are you sure you want to delete this item?")) return;
                try {
                    const docRef = doc(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME, id);
                    await deleteDoc(docRef);
                    setIsFormOpen(false);
                } catch (err) {
                    console.error(err);
                    alert("Failed to delete item");
                }
            };

            const handleBatchImport = async (records) => {
                if (!user) return;
                const batchSize = 400;
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', COLLECTION_NAME);

                try {
                    for (let i = 0; i < records.length; i += batchSize) {
                        const batch = writeBatch(db);
                        const chunk = records.slice(i, i + batchSize);
                        
                        chunk.forEach(record => {
                            const newDocRef = doc(colRef);
                            batch.set(newDocRef, {
                                ...record,
                                updatedBy: user.uid,
                                importedAt: new Date().toISOString()
                            });
                        });
                        
                        await batch.commit();
                    }
                    setIsImportOpen(false);
                } catch (err) {
                    console.error("Import error", err);
                    alert("Failed to import items.");
                }
            };

            const filteredInventory = useMemo(() => {
                return inventory.filter(item => {
                    const matchesSearch = item.equipment.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                          item.location.toLowerCase().includes(searchTerm.toLowerCase());
                    const matchesApparatus = filterApparatus === 'All' || item.apparatus === filterApparatus;
                    return matchesSearch && matchesApparatus;
                });
            }, [inventory, searchTerm, filterApparatus]);

            const stats = useMemo(() => {
                const expired = inventory.filter(i => isExpired(i.expires)).length;
                const expiringSoon = inventory.filter(i => isExpiringSoon(i.expires)).length;
                const total = inventory.length;
                return { expired, expiringSoon, total };
            }, [inventory]);

            if (loading) return <div className="flex h-screen items-center justify-center text-gray-500 font-medium animate-pulse">Loading EMS Inventory...</div>;
            if (error) return <div className="flex h-screen items-center justify-center text-red-500 font-medium">{error}</div>;

            return (
                <div className="min-h-screen bg-gray-100 flex flex-col font-sans">
                    <header className="bg-slate-800 text-white p-4 shadow-md sticky top-0 z-40 safe-top">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex items-center space-x-2">
                                <Truck size={28} className="text-red-400" />
                                <h1 className="text-2xl font-bold tracking-tight">PTFD Apparatus Inventory</h1>
                            </div>
                            
                            <div className="flex space-x-3">
                                <button 
                                    onClick={() => setIsImportOpen(true)}
                                    className="flex items-center px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition shadow-sm border border-slate-600 active:bg-slate-800"
                                >
                                    <FileUp size={18} className="mr-2" /> Import
                                </button>
                                <button 
                                    onClick={() => {
                                        setEditingItem(null);
                                        setIsFormOpen(true);
                                    }}
                                    className="flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-bold transition shadow-sm border border-red-500 active:bg-red-800"
                                >
                                    <Plus size={18} className="mr-2" /> Add
                                </button>
                            </div>
                        </div>
                    </header>

                    <div className="bg-white border-b shadow-sm sticky top-[72px] z-30">
                        <div className="max-w-7xl mx-auto px-4 py-3 flex space-x-6 text-sm overflow-x-auto no-scrollbar">
                            <div className="flex items-center text-gray-600 whitespace-nowrap bg-blue-50 px-3 py-1 rounded-full">
                                <Package size={16} className="mr-2 text-blue-500" />
                                <span className="font-bold mr-1">{stats.total}</span> Total
                            </div>
                            <div className="flex items-center text-gray-600 whitespace-nowrap bg-red-50 px-3 py-1 rounded-full">
                                <AlertTriangle size={16} className="mr-2 text-red-500" />
                                <span className="font-bold text-red-600 mr-1">{stats.expired}</span> Expired
                            </div>
                            <div className="flex items-center text-gray-600 whitespace-nowrap bg-yellow-50 px-3 py-1 rounded-full">
                                <Calendar size={16} className="mr-2 text-yellow-500" />
                                <span className="font-bold text-yellow-600 mr-1">{stats.expiringSoon}</span> Soon
                            </div>
                        </div>
                    </div>

                    <main className="flex-1 max-w-7xl w-full mx-auto p-4 space-y-4 pb-20 safe-bottom">
                        <div className="flex flex-col md:flex-row gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                            <div className="flex-1 relative">
                                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={20} />
                                <input 
                                    type="text" 
                                    placeholder="Search equipment or location..." 
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-base"
                                />
                            </div>
                            
                            <div className="flex items-center space-x-2 w-full md:w-auto">
                                <Filter size={20} className="text-gray-500" />
                                <select 
                                    value={filterApparatus}
                                    onChange={(e) => setFilterApparatus(e.target.value)}
                                    className="flex-1 md:w-48 py-3 px-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none text-base"
                                >
                                    <option value="All">All Apparatus</option>
                                    <option value="Medic 75">Medic 75</option>
                                    <option value="Engine 1-75">Engine 1-75</option>
                                    <option value="Stock Room">Stock Room</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200">
                            <div className="overflow-x-auto">
                                <table className="w-full text-left text-sm">
                                    <thead className="bg-gray-50 text-gray-500 font-bold border-b border-gray-200">
                                        <tr>
                                            <th className="px-6 py-4 whitespace-nowrap">Equipment</th>
                                            <th className="px-6 py-4 whitespace-nowrap">Apparatus / Loc</th>
                                            <th className="px-6 py-4 whitespace-nowrap">Status</th>
                                            <th className="px-6 py-4 whitespace-nowrap text-right">Expires</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100">
                                        {filteredInventory.length === 0 ? (
                                            <tr>
                                                <td colSpan="4" className="px-6 py-12 text-center text-gray-500">
                                                    No items found. Try adjusting filters or import data.
                                                </td>
                                            </tr>
                                        ) : (
                                            filteredInventory.map((item) => (
                                                <tr 
                                                    key={item.id} 
                                                    onClick={() => {
                                                        setEditingItem(item);
                                                        setIsFormOpen(true);
                                                    }}
                                                    className="group cursor-pointer hover:bg-blue-50 active:bg-blue-100 transition-colors duration-150 touch-manipulation"
                                                >
                                                    <td className="px-6 py-5">
                                                        <div className="font-bold text-gray-900 text-base">{item.equipment}</div>
                                                        {item.notes && <div className="text-xs text-gray-500 mt-1">{item.notes}</div>}
                                                    </td>
                                                    <td className="px-6 py-5">
                                                        <div className="text-gray-800 font-medium">{item.apparatus}</div>
                                                        <div className="text-xs text-gray-500 flex items-center mt-1">
                                                            <MapPin size={12} className="mr-1" />
                                                            {item.location} {item.subLocation ? `— ${item.subLocation}` : ''}
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-5">
                                                        <StatusBadge expires={item.expires} />
                                                    </td>
                                                    <td className="px-6 py-5 text-gray-600 font-mono text-sm text-right flex items-center justify-end">
                                                        <span>{formatDateDisplay(item.expires)}</span>
                                                        <ChevronRight size={16} className="ml-2 text-gray-300 group-hover:text-blue-400" />
                                                    </td>
                                                </tr>
                                            ))
                                        )}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </main>

                    <Modal 
                        isOpen={isFormOpen} 
                        onClose={() => setIsFormOpen(false)} 
                        title={editingItem ? "Edit Item" : "Add New Item"}
                    >
                        <ItemForm 
                            initialData={editingItem} 
                            onSubmit={editingItem ? handleUpdateItem : handleAddItem}
                            onCancel={() => setIsFormOpen(false)}
                            onDelete={editingItem ? () => handleDeleteItem(editingItem.id) : null}
                        />
                    </Modal>

                    <Modal 
                        isOpen={isImportOpen} 
                        onClose={() => setIsImportOpen(false)} 
                        title="Import CSV Data"
                    >
                        <CSVImporter 
                            onImport={handleBatchImport} 
                            onClose={() => setIsImportOpen(false)} 
                        />
                    </Modal>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>